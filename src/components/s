<template>
  <div class="container mx-auto py-7">
    <div
      class="md:h-[65vh] h-fit relative rounded-2xl flex items-center p-4 bg-gradient-to-br from-[var(--p-primary-color)] to-[#A6A9FF] overflow-x-hidden"
      @mouseenter="stopAutoplay"
      @mouseleave="startAutoplay"
    >
      <div
        class="header_title w-1/2 flex flex-col gap-4 text-[var(--p-primary-contrast-color)]"
      >
        <div class="md:h-[12rem]">
          <span
            class="badge p-1 text-sm border border-white rounded-md uppercase w-fit"
            >Новинка</span
          >
          <transition name="fade-slide" mode="out-in">
            <h1
              :key="slides[currentSlide].title"
              class="text-sm md:text-4xl font-medium w-5/6 mt-3 text-[var(--p-primary-contrast-color)] uppercase"
            >
              {{ slides[currentSlide].title }}
            </h1>
          </transition>
          <transition name="fade-slide" mode="out-in">
            <p :key="slides[currentSlide].subtitle" class="text-sm md:text-2xl">
              {{ slides[currentSlide].subtitle }}
            </p>
          </transition>
        </div>
        <router-link to="/catalog">
          <button
            class="bg-white shadow-2xl text-[var(--p-primary-color)] px-4 py-2 rounded-md md:text-lg text-sm"
          >
            Перейти в католог
          </button>
        </router-link>

        <!-- Карусель-управление -->
        <div class="flex items-center gap-2 mt-6 select-none justify-start">
          <button
            @click="prevSlide"
            :disabled="currentSlide === 0"
            class="cursor-pointer px-2 py-1 border border-white/30 text-lg text-white hover:bg-white/50 transition rounded-4xl disabled:opacity-50"
          >
            &#8592;
          </button>
          <div class="slide-progress flex items-center gap-2">
            <span>{{ currentSlide + 1 }}</span>
            <div
              class="slide-progress__track w-24 h-1 bg-white/40 rounded overflow-hidden mx-2"
            >
              <div
                class="slide-progress__indicator bg-white h-full transition-all duration-300"
                :style="{ width: progressWidth }"
              ></div>
            </div>
            <span>{{ slides.length }}</span>
          </div>
          <button
            @click="nextSlide"
            :disabled="currentSlide === slides.length - 1"
            class="px-2 cursor-pointer py-1 border border-white/30 rounded-4xl text-lg text-white hover:bg-white/50 transition disabled:opacity-50"
          >
            &#8594;
          </button>
        </div>
      </div>
      <div class="header_image h-full w-1/4 md:w-1/2 flex items-center">
        <transition name="image-fade" mode="out-in">
          <img
            :key="slides[currentSlide].img + currentSlide"
            class="w-[80%] h-full absolute object-contain -right-1/4 bottom-0"
            :src="slides[currentSlide].img"
            alt=""
          />
        </transition>
      </div>
    </div>
  </div>
</template>
<script>
const defaultImage = new URL("../assets/home_image.png", import.meta.url).href;

export default {
  name: "HomeHeader",
  data() {
    return {
      slides: [
        {
          title: "Электросамокаты Kugoo Kirin от официального дилера",
          subtitle: "с бесплатной доставкой по РФ от 1 дня",
          img: defaultImage,
        },
        {
          title: "Комфортные городские прогулки",
          subtitle:
            "Подвеска, широкая дека и регулировка руля для максимального удобства",
          img: defaultImage,
        },
        {
          title: "Безопасные ночные поездки",
          subtitle:
            "Яркая подсветка, сигнализация и приложение для контроля маршрута",
          img: defaultImage,
        },
        {
          title: "Сезонные скидки на новые модели",
          subtitle:
            "Выгодные предложения весенней коллекции — только до конца месяца",
          img: defaultImage,
        },
        {
          title: "Гарантия и сервисное обслуживание",
          subtitle:
            "Бесплатная диагностика и поддержка в течение всего гарантийного срока",
          img: defaultImage,
        },
      ],
      currentSlide: 0,
      autoplayDelay: 5000,
      autoplayTimer: null,
    };
  },
  computed: {
    lastSlideIndex() {
      return this.slides.length - 1;
    },
    progressWidth() {
      if (!this.slides.length) {
        return "0%";
      }
      const percentage = ((this.currentSlide + 1) / this.slides.length) * 100;
      return `${percentage}%`;
    },
  },
  methods: {
    startAutoplay() {
      this.stopAutoplay();
      if (this.slides.length <= 1) {
        return;
      }
      this.autoplayTimer = window.setInterval(
        this.autoAdvance,
        this.autoplayDelay
      );
    },
    stopAutoplay() {
      if (this.autoplayTimer !== null) {
        clearInterval(this.autoplayTimer);
        this.autoplayTimer = null;
      }
    },
    autoAdvance() {
      if (this.currentSlide < this.lastSlideIndex) {
        this.currentSlide += 1;
      } else {
        this.currentSlide = 0;
      }
    },
    nextSlide() {
      if (this.currentSlide < this.lastSlideIndex) {
        this.currentSlide += 1;
      }
    },
    prevSlide() {
      if (this.currentSlide > 0) {
        this.currentSlide -= 1;
      }
    },
    goToSlide(index) {
      if (index >= 0 && index <= this.lastSlideIndex) {
        this.currentSlide = index;
      }
    },
  },
};
</script>
<style scoped>
.fade-slide-enter-active,
.fade-slide-leave-active {
  transition: opacity 0.4s ease, transform 0.4s ease;
}

.fade-slide-enter-from,
.fade-slide-leave-to {
  opacity: 0;
  transform: translateY(12px);
}

.fade-slide-leave-from,
.fade-slide-enter-to {
  opacity: 1;
  transform: translateY(0);
}

.image-fade-enter-active,
.image-fade-leave-active {
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.image-fade-enter-from,
.image-fade-leave-to {
  opacity: 0;
  transform: scale(0.96);
}

.image-fade-leave-from,
.image-fade-enter-to {
  opacity: 1;
  transform: scale(1);
}

.slide-progress {
  flex: 1;
  max-width: 200px;
}

.slide-progress__track {
  position: relative;
  height: 4px;
  background-color: rgba(255, 255, 255, 0.25);
  border-radius: 9999px;
  overflow: hidden;
}

.slide-progress__indicator {
  height: 100%;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.85),
    rgba(255, 255, 255, 1)
  );
  border-radius: 9999px;
  transition: width 0.45s ease-in-out;
  will-change: width;
}
</style>
